{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/serius/Desktop/Practicals/Projects/todo/packages/react-meteor-data/useTracker.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/react-meteor-data/useTracker.ts","filename":"/home/serius/Desktop/Practicals/Projects/todo/packages/react-meteor-data/useTracker.ts","inputSourceMap":{"version":3,"file":"packages/react-meteor-data/useTracker.ts","sourceRoot":"","sources":["packages/react-meteor-data/useTracker.ts"],"names":[],"mappings":"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","sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  (c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    const data = reactiveFn(c);\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = data;\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To clean up side effects in render, stop the computation immediately\n  if (!refs.isMounted) {\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n          const data = reactiveFn(c);\n          refs.computation = c;\n          if (!skipUpdate(refs.trackerData, data)) {\n            // For any reactive change, forceUpdate and let the next render rebuild the computation.\n            forceUpdate();\n          }\n        }));\n      }\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n    comp?: Tracker.Computation;\n    isMounted?: boolean;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        const data = refs.reactiveFn();\n        if (c.firstRun) {\n          refs.data = data;\n        } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n\n    // Stop the computation immediately to avoid creating side effects in render.\n    // refers to this issues:\n    // https://github.com/meteor/react-packages/issues/382\n    // https://github.com/meteor/react-packages/issues/381\n    if (refs.comp) refs.comp.stop();\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n    refs.comp = comp;\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(\n        () => Tracker.autorun((c) => {\n          const data: T = refs.reactiveFn(c);\n          if (!skipUpdate || !skipUpdate(refs.data, data)) {\n            refs.data = data;\n            forceUpdate();\n          }\n        })\n      );\n    }\n\n    return () => {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst _useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = _useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport const useTracker = Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : _useTracker;\n"]},"targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/home/serius/Desktop/Practicals/Projects/todo","root":"/home/serius/Desktop/Practicals/Projects/todo","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":{},"_verified":{},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"_exploded":{},"_verified":{},"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"MemberExpression":{"enter":[null]}},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/home/serius/Desktop/Practicals/Projects/todo/packages/react-meteor-data/useTracker.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/react-meteor-data/useTracker.ts"}},"code":"var _typeof;\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 0);\nmodule.export({\n  useTracker: function () {\n    return useTracker;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 1);\nvar useReducer, useEffect, useRef, useMemo;\nmodule.link(\"react\", {\n  useReducer: function (v) {\n    useReducer = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  }\n}, 2);\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor(data) {\n  var shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && _typeof(data) === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach(function (key) {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn('Warning: your reactive function is returning a Mongo cursor. ' + 'This value will not be reactive. You probably want to call ' + '`.fetch()` on the cursor before returning it.');\n  }\n}\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nvar fur = function (x) {\n  return x + 1;\n};\nvar useForceUpdate = function () {\n  return useReducer(fur, 0)[1];\n};\nvar useTrackerNoDeps = function (reactiveFn) {\n  var skipUpdate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var _useRef = useRef({\n      isMounted: false,\n      trackerData: null\n    }),\n    refs = _useRef.current;\n  var forceUpdate = useForceUpdate();\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(function () {\n    return Tracker.autorun(function (c) {\n      refs.computation = c;\n      var data = reactiveFn(c);\n      if (c.firstRun) {\n        // Always run the reactiveFn on firstRun\n        refs.trackerData = data;\n      } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n        // For any reactive change, forceUpdate and let the next render rebuild the computation.\n        forceUpdate();\n      }\n    });\n  });\n  // To clean up side effects in render, stop the computation immediately\n  if (!refs.isMounted) {\n    Meteor.defer(function () {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n  useEffect(function () {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(function () {\n          return Tracker.autorun(function (c) {\n            var data = reactiveFn(c);\n            refs.computation = c;\n            if (!skipUpdate(refs.trackerData, data)) {\n              // For any reactive change, forceUpdate and let the next render rebuild the computation.\n              forceUpdate();\n            }\n          });\n        });\n      }\n    }\n    // stop the computation on unmount\n    return function () {\n      var _refs$computation;\n      (_refs$computation = refs.computation) === null || _refs$computation === void 0 ? void 0 : _refs$computation.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    };\n  }, []);\n  return refs.trackerData;\n};\nvar useTrackerWithDeps = function (reactiveFn, deps) {\n  var skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var forceUpdate = useForceUpdate();\n  var _useRef2 = useRef({\n      reactiveFn: reactiveFn\n    }),\n    refs = _useRef2.current;\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n  useMemo(function () {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    var comp = Tracker.nonreactive(function () {\n      return Tracker.autorun(function (c) {\n        var data = refs.reactiveFn();\n        if (c.firstRun) {\n          refs.data = data;\n        } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      });\n    });\n    // Stop the computation immediately to avoid creating side effects in render.\n    // refers to this issues:\n    // https://github.com/meteor/react-packages/issues/382\n    // https://github.com/meteor/react-packages/issues/381\n    if (refs.comp) refs.comp.stop();\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n    refs.comp = comp;\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(function () {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n  useEffect(function () {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(function () {\n        return Tracker.autorun(function (c) {\n          var data = refs.reactiveFn(c);\n          if (!skipUpdate || !skipUpdate(refs.data, data)) {\n            refs.data = data;\n            forceUpdate();\n          }\n        });\n      });\n    }\n    return function () {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n  return refs.data;\n};\nfunction useTrackerClient(reactiveFn) {\n  var deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\nvar useTrackerServer = function (reactiveFn) {\n  return Tracker.nonreactive(reactiveFn);\n};\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nvar _useTracker = Meteor.isServer ? useTrackerServer : useTrackerClient;\nfunction useTrackerDev(reactiveFn) {\n  var deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  function warn(expects, pos, arg, type) {\n    console.warn(\"Warning: useTracker expected a \" + expects + \" in it's \" + pos + \" argument \" + (\"(\" + arg + \"), but got type of `\" + type + \"`.\"));\n  }\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\", _typeof(deps) + \" & \" + _typeof(skipUpdate));\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", _typeof(deps));\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", _typeof(skipUpdate));\n    }\n  }\n  var data = _useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\nvar useTracker = Meteor.isDevelopment ? useTrackerDev : _useTracker;","map":{"version":3,"mappings":"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","names":["module","default","_typeof","export","useTracker","Meteor","Tracker","useReducer","useEffect","useRef","useMemo","checkCursor","data","shouldWarn","Package","mongo","Mongo","Cursor","Object","getPrototypeOf","prototype","keys","forEach","key","console","warn","fur","x","useForceUpdate","useTrackerNoDeps","reactiveFn","skipUpdate","isMounted","trackerData","refs","current","forceUpdate","computation","stop","nonreactive","autorun","c","firstRun","defer","useTrackerWithDeps","deps","comp","useTrackerClient","undefined","Array","isArray","useTrackerServer","_useTracker","isServer","useTrackerDev","expects","pos","arg","type","isDevelopment"],"sourceRoot":"","sources":["packages/react-meteor-data/useTracker.ts"],"sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  (c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    const data = reactiveFn(c);\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = data;\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To clean up side effects in render, stop the computation immediately\n  if (!refs.isMounted) {\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n          const data = reactiveFn(c);\n          refs.computation = c;\n          if (!skipUpdate(refs.trackerData, data)) {\n            // For any reactive change, forceUpdate and let the next render rebuild the computation.\n            forceUpdate();\n          }\n        }));\n      }\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n    comp?: Tracker.Computation;\n    isMounted?: boolean;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        const data = refs.reactiveFn();\n        if (c.firstRun) {\n          refs.data = data;\n        } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n\n    // Stop the computation immediately to avoid creating side effects in render.\n    // refers to this issues:\n    // https://github.com/meteor/react-packages/issues/382\n    // https://github.com/meteor/react-packages/issues/381\n    if (refs.comp) refs.comp.stop();\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n    refs.comp = comp;\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(\n        () => Tracker.autorun((c) => {\n          const data: T = refs.reactiveFn(c);\n          if (!skipUpdate || !skipUpdate(refs.data, data)) {\n            refs.data = data;\n            forceUpdate();\n          }\n        })\n      );\n    }\n\n    return () => {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst _useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = _useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport const useTracker = Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : _useTracker;\n"]},"sourceType":"module","externalDependencies":{},"hash":"02852b9065391d945426a2810e6f17c0320cfe1a"}
